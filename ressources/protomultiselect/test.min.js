var FacebookList=Class.create(TextboxList,{loptions:$H({autocomplete:{opacity:0.8,maxresults:10,minchars:1}}),initialize:function($super,c,e,a,d){$super(c,a);this.data=[];this.autoholder=$(e).setOpacity(this.loptions.get("autocomplete").opacity);this.autoholder.observe("mouseover",function(){this.curOn=true;}.bind(this)).observe("mouseout",function(){this.curOn=false;}.bind(this));this.autoresults=this.autoholder.select("ul").first();var b=this.autoresults.select("li");b.each(function(f){this.add({value:f.readAttribute("value"),caption:f.innerHTML});},this);},autoShow:function(a){this.autoholder.setStyle({display:"block"});this.autoholder.descendants().each(function(d){d.hide();});if(!a||!a.strip()||(!a.length||a.length<this.loptions.get("autocomplete").minchars)){this.autoholder.select(".default").first().setStyle({display:"block"});this.resultsshown=false;}else{this.resultsshown=true;this.autoresults.setStyle({display:"block"}).update("");if(this.options.get("wordMatch")){var c=new RegExp("(^|\\s)"+a,"i");}else{var c=new RegExp(a,"i");}var b=0;this.data.filter(function(d){return d?c.test(d.evalJSON(true).caption):false;}).each(function(d,f){b++;if(f>=this.loptions.get("autocomplete").maxresults){return;}var g=this;var e=new Element("li");e.observe("click",function(h){h.stop();g.autoAdd(this);}).observe("mouseover",function(){g.autoFocus(this);}).update(this.autoHighlight(d.evalJSON(true).caption,a));this.autoresults.insert(e);e.cacheData("result",d.evalJSON(true));if(f==0){this.autoFocus(e);}},this);}if(b>this.options.get("results")){this.autoresults.setStyle({height:(this.options.get("results")*24)+"px"});}else{this.autoresults.setStyle({height:(b?(b*24):0)+"px"});}return this;},autoHighlight:function(b,a){return b.gsub(new RegExp(a,"i"),function(c){return"<em>"+c[0]+"</em>";});},autoHide:function(){this.resultsshown=false;this.autoholder.hide();return this;},autoFocus:function(a){if(!a){return;}if(this.autocurrent){this.autocurrent.removeClassName("auto-focus");}this.autocurrent=a.addClassName("auto-focus");return this;},autoMove:function(a){if(!this.resultsshown){return;}this.autoFocus(this.autocurrent[(a=="up"?"previous":"next")]());this.autoresults.scrollTop=this.autocurrent.positionedOffset()[1]-this.autocurrent.getHeight();return this;},autoFeed:function(a){if(this.data.indexOf(Object.toJSON(a))==-1){this.data.push(Object.toJSON(a));}return this;},autoAdd:function(b){if(!b||!b.retrieveData("result")){return;}this.add(b.retrieveData("result"));delete this.data[this.data.indexOf(Object.toJSON(b.retrieveData("result")))];this.autoHide();var a=this.lastinput||this.current.retrieveData("input");a.clear().focus();return this;},createInput:function($super,c){var a=$super(c);var b=a.retrieveData("input");b.observe("keydown",function(d){this.dosearch=false;switch(d.keyCode){case Event.KEY_UP:d.stop();return this.autoMove("up");case Event.KEY_DOWN:d.stop();return this.autoMove("down");case Event.KEY_RETURN:d.stop();if(!this.autocurrent){break;}this.autoAdd(this.autocurrent);this.autocurrent=false;this.autoenter=true;break;case Event.KEY_ESC:this.autoHide();if(this.current&&this.current.retrieveData("input")){this.current.retrieveData("input").clear();}break;default:this.dosearch=true;}}.bind(this));b.observe("keyup",function(d){switch(d.keyCode){case Event.KEY_UP:case Event.KEY_DOWN:case Event.KEY_RETURN:case Event.KEY_ESC:break;default:if(!Object.isUndefined(this.options.get("fetchFile"))){new Ajax.Request(this.options.get("fetchFile"),{parameters:{keyword:b.value},onSuccess:function(e){e.responseText.evalJSON(true).each(function(f){this.autoFeed(f);}.bind(this));this.autoShow(b.value);}.bind(this)});}else{if(this.dosearch){this.autoShow(b.value);}}}}.bind(this));b.observe(Prototype.Browser.IE?"keydown":"keypress",function(d){if(this.autoenter){d.stop();}this.autoenter=false;}.bind(this));return a;},createBox:function($super,e,d){var b=$super(e,d);b.observe("mouseover",function(){this.addClassName("bit-hover");}).observe("mouseout",function(){this.removeClassName("bit-hover");});var c=new Element("a",{href:"#","class":"closebutton"});c.observe("click",function(a){a.stop();if(!this.current){this.focus(this.maininput);}this.dispose(b);}.bind(this));b.insert(c).cacheData("text",Object.toJSON(e));return b;}});Element.addMethods({onBoxDispose:function(a,b){b.autoFeed(a.retrieveData("text").evalJSON(true));},onInputFocus:function(a,b){b.autoShow();},onInputBlur:function(a,b){b.lastinput=a;if(!b.curOn){b.blurhide=b.autoHide.bind(b).delay(0.1);}},filter:function(c,b){var d=[];for(var e=0,a=this.length;e<a;e++){if(c.call(b,this[e],e,this)){d.push(this[e]);}}return d;}});